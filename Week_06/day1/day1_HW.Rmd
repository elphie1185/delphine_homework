---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(readr)
library(ggplot2)
```

1. Load in the dataset and call it drinks_content, eyeball it by printing it out (first 5 rows, last 5 rows, and then all of the data) and find out the dimensions (number of rows/columns) and variable names.
```{r}
drinks_content <- read_csv("data/starbucks_drinkMenu_expanded.csv")
```


```{r}
dim(drinks_content)
names(drinks_content)
head(drinks_content, 5)
tail(drinks_content, 5)
```

2. Calculate some quick summary statistics to check the mean, the variance, and the normality of this variable.
```{r}
summarise(drinks_content, mean(Calories), var(Calories))
```

```{r}
ggplot(drinks_content) +
  aes(x = Calories) +
  geom_histogram(binwidth = 40, fill = "navajowhite2", colour = "navajowhite4") +
  scale_x_continuous(breaks = seq(0, 500, 50)) +
  labs(
    x = "\nNumber of Calories", 
    y = "Frequency of Occurence\n", 
    title = "Distribution of the Calories\nin Starbucks Coffee"
  ) +
  theme_dark()
  
```

3. Check if you have any outliers in the Calories variable by creating a boxplot. Then get the actual values of any outliers you have. Finally remove the outliers and save the new tibble as drinks_content_nooutlier
```{r}
ggplot(drinks_content) +
  aes(y = Calories) +
  geom_boxplot() +
  labs(
    x = "\nNumber of Calories", 
    y = "Frequency of Occurence\n", 
    title = "Boxplot of the Calories\nin Starbucks Coffee"
  ) 
```

```{r}
outliers <- boxplot(drinks_content$Calories, 
                    plot = FALSE)$out
drinks_content[which(drinks_content$Calories %in% outliers), ]
drinks_content_nooutlier <- drinks_content[-which(drinks_content$Calories %in% outliers), ]
```

4. Select the variables beverage_category, beverage, beverage prep and calories from the data (drinks_content_nooutlier), and assign it to a new tibble called drinks. Since we are interested in the calorie content, check if there are any NA values in the data, and drop them if there are

```{r}
drinks <- select(drinks_content_nooutlier, Beverage_category, Beverage, 
                 Beverage_prep, Calories)
sum(is.na(drinks$Calories))
unique(drinks$Calories)
```

5. Filter the data so we only take “classic espresso drinks”, and save this in a new tibble called espresso_drinks
```{r}
espresso_drinks <- filter(drinks, 
                          Beverage_category == "Classic Espresso Drinks")
```

6. Create a new tibble called drink_calories which contains a variable called calorie_diff. calorie_diff should store the difference between 135 calories (135 calories = 10 cubes of sugar!) and the calories in each drink. (hint: you’ll want to subtract the calories from 135 to see which drink have more or less than 10 cups of sugar).
```{r}
drinks_calories <- mutate(espresso_drinks, calorie_diff = 135 - Calories)
```

7. Create a new tibble called drinks_grouped where you group your data by the type of beverage prep. Then summarise the mean calories in each drink (by group) in a variable called mean_cal, and save it to drinks_summary. Finally arrange this summary data in descending order of mean calories.
```{r}
drinks_grouped <- group_by(drinks_calories, Beverage)
drinks_summary<- summarise(drinks_grouped, mean_cal = mean(Calories))
arrange(drinks_summary, desc(mean_cal))
```

Finish up by using the %>% operator to put all the answers you’ve got from questions 4-7 into one pipe. You don’t need to include the check for NA values in this, as you’d typically check that before you start doing any analysis.

```{r}
pipe_drinks <- drinks_content_nooutlier %>%
  select(Beverage_category, Beverage, Beverage_prep, Calories) %>%
  filter(Beverage_category == "Classic Espresso Drinks") %>%
  mutate(calorie_diff = 135 - Calories) %>%
  group_by(Beverage) %>%
  summarise(mean_cal = mean(Calories)) %>%
  arrange(desc(mean_cal))
```

 
Use the drink_calories data, and for each drink, use the min_rank function to find the two drinks (Beverage) with most Calories. Save this in a new tibble called most_calories.
```{r}
most_calories <- drinks_calories %>%
  group_by(Beverage) %>%
   filter(min_rank(desc(Calories)) %in% c(1,2))
```


For each drink in the drinks_grouped data, find all drinks which more calories than the average drink. Save this in a new tibble called  above_average_calories.
```{r}
above_average_calories <- drinks_grouped %>%
  group_by(Beverage) %>%
  filter(Calories > mean(Calories))
```


Within each drink group, rank each beverage by the number of calories. Save this ranking in a new column called ranking. Save the new output in a new tibble called drinks_ranked.
```{r}
drinks_ranked <- drinks %>%
  group_by(Beverage_category) %>%
  mutate(ranking = min_rank(Calories)) %>%
  arrange(ranking)
```


Using the drinks_grouped data, apply the cume_dist function to get the top 25% of Calorie drinks within each group. Save this in a new tibble called  drinks_distribution.
```{r}
drinks_distribution <- drinks_grouped %>%
  arrange(Calories) %>%
  mutate(cumul_dist = cume_dist(Calories)) %>%
  filter(cumul_dist < 0.25)
```




















