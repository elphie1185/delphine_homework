---
title: "R Notebook"
output: html_notebook
---

Load libraries
```{r}
library(CodeClanData)
library(tidyverse)
```

1. Use the stock prices data from the CodeClanData: IBM_stock_price and JNJ_stock_price
```{r}
IBM_stock_price <- IBM_stock_price
JNJ_stock_price <- JNJ_stock_price
```


```{r}
dim(IBM_stock_price)
dim(JNJ_stock_price)
```

```{r}
head(IBM_stock_price)
head(JNJ_stock_price)
```

2. Your JNJ data is in wide format. Reshape it so it is in long format. Create two columns: one called date and one called jnj_open (as it is open stock prices). Save it in a new tibble called JNJ_stock_price_gathered.

```{r}
JNJ_stock_price_gathered <- gather(JNJ_stock_price, 
                                   date, 
                                   jnj_open)
```

3. Your IBM data has a variable called agents in it, which contains the initials of the two staff working. Separate out this column into two:  agent1 and agent2. Save the output in a new tibble called IBM_agents.
```{r}
IBM_agents <- separate(IBM_stock_price, 
                       Agents,
                       c("agent1", "agent2"), 
                       sep = "/", 
                       remove = FALSE)
```

4. Use the unite function to unite the Agent ID columns (ID1,ID2) with the agent initials. Use a colon as a separator. Hint: you might need to use a pipe to do 2 unite functions. Select only the agent variables and save it in a tibble called IBM_agent_data
```{r}
IBM_agent_data_first <- unite(IBM_agents, 
                              agent1, 
                              c("agent1", "ID1"), 
                              sep = ":")

IBM_agent_data <- unite(IBM_agent_data_first, 
                              agent2, 
                              c("agent2", "ID2"), 
                              sep = ":")
```

5. Your JNJ data only has data for open stock. Therefore first thing to do is create a new tibble called IBM_data, which selects only the date and the open stock data from the IBM_stock_data tibble. Once you have that, use a full join to join the IBM_data and JNJ_data tibbles. Save it in a new tibble called open_stock_data.

```{r}
IBM_data <- select(IBM_agent_data, date, open)
open_stock_data <- full_join(JNJ_stock_price_gathered, IBM_data, 
                             by = "date")
colnames(open_stock_data) <- c("date", "JNJ", "IBM")
```

6. Write a for loop which calculates the mean of each variable in the open_stock dataset. Save the output in a vector called  stock_mean_data.


```{r}
stock_mean_data <- c()
for(i in 1:ncol(open_stock_data)){
  if (i > 1) {
    mean_val <- colMeans(open_stock_data[, i])
    stock_mean_data <- c(stock_mean_data,  
                         mean_val)
  }
}
stock_mean_data
```


7. Now do the same calculation with the appropriate map function.

```{r}
map_if(open_stock_data[, 2:3], 
       is.numeric, 
       mean)
```

Extension : Tasks
Write a loop which calculates the length of each variable in open_stock

```{r}
var_length_vect <- c()
for(i in 1:ncol(open_stock_data)){
  var_name <- colnames(open_stock_data[, i])
  var_length <- nrow(open_stock_data[, i])
  var_length_vect <- c(var_length_vect, var_name, var_length)
}

var_length_data <- matrix(var_length_vect, ncol = 2, byrow = TRUE)
colnames(var_length_data) <- c("Variable", "Variable length")
var_length_data
```


Write a loop which prints the type of each variable in open_stock
```{r}
var_summary <- c()
for(i in 1:ncol(open_stock_data)){
  var_name <- colnames(open_stock_data)[i]
  var_type <- class(unlist(open_stock_data[, i]))
  var_summary <- c(var_summary, var_name, var_type)
}

var_name_data <- data.frame(matrix(var_summary, ncol = 2, byrow = TRUE))
var_name_data
```


Use the map function to turn your date column in stock_data into datetimes.
```{r}
library(lubridate)
map(open_stock_data$date, dmy)

class(map(open_stock_data$date, dmy)[[1]])
```


Use the map function to calculate the median of the stock price.
```{r}
map_if(open_stock_data[, 2:3], 
       is.numeric, 
       median)
```

Calculate summary stats for all the numeric variables.
```{r}
map_if(open_stock_data[, 2:3], 
       is.numeric, 
       summary)
```

